<!doctype>
<head>
    <link type="text/css" rel="stylesheet" href="http://code.shutterstock.com/rickshaw/rickshaw.min.css">
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.0/themes/smoothness/jquery-ui.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.0/jquery-ui.min.js"></script>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://code.shutterstock.com/rickshaw/rickshaw.min.js"></script>
    <!-- data -->
    <script src="temperature.js"></script>
    <script src="wiiboard1.js"></script>
    <script src="wiiboard2.js"></script>
</head>
<body>

<style>
#chart_container {
    display: inline-block;
    font-family: Arial, Helvetica, sans-serif;
}
#chart {
    float: left;
}
#legend {
    float: left;
    margin-left: 15px;
}
#offset_form {
    float: left;
    margin: 2em 0 0 15px;
    font-size: 13px;
}
#y_axis {
    float: left;
    width: 40px;
}
.swatch {
    display: inline-block;
    width: 10px;
    height: 10px;
    margin: 0 8px 0 0;
}
.label {
    display: inline-block;
}
</style>

<!-- http://code.shutterstock.com/rickshaw/examples/extensions.html -->
<div id="chart_container">
    <div id="y_axis"></div>
    <div id="chart"></div>
    <div id="legend"></div>
    <form id="offset_form" class="toggler">
        <input type="radio" name="offset" id="lines" value="line" checked>
        <label class="lines" for="lines">lines</label><br>
        <input type="radio" name="offset" id="stack" value="stack">
        <label class="stack" for="stack">stack</label>
    </form>
</div>
<div id="range_slider"></div>
<div id="hover_legend"></div>

<script>
function get(data) {
    data.forEach(function(elt, index, arr) {
        arr[index] = {'x': elt[0], 'y': elt[1]};
    });
    return data;
}

var palette = new Rickshaw.Color.Palette();

var format = d3.time.format("%s.N");
var graph = new Rickshaw.Graph({
    element: document.getElementById("chart"),
    width: 540,
    height: 240,
    renderer: 'line',
    series: [{
        name: 'weight1 in Kg',
        data: get(wiiboard1),
        color: palette.color(),
    }, {
        name: 'weight2 in Kg',
        data: get(wiiboard2),
        color: palette.color(),
    }, {
        name: 'temperature in Â°C',
        data: get(temperature),
        color: palette.color(),
    }],
});

var hover_legend = document.querySelector('#hover_legend');
var Hover = Rickshaw.Class.create(Rickshaw.Graph.HoverDetail, {

    render: function(args) {

        hover_legend.innerHTML = args.formattedXValue;

        args.detail.sort(function(a, b) { return a.order - b.order }).forEach( function(d) {

            var line = document.createElement('div');
            line.className = 'line';

            var swatch = document.createElement('div');
            swatch.className = 'swatch';
            swatch.style.backgroundColor = d.series.color;

            var label = document.createElement('div');
            label.className = 'label';
            label.innerHTML = d.name + ": " + d.formattedYValue;

            line.appendChild(swatch);
            line.appendChild(label);

            hover_legend.appendChild(line);

            var dot = document.createElement('div');
            dot.className = 'dot';
            dot.style.top = graph.y(d.value.y0 + d.value.y) + 'px';
            dot.style.borderColor = d.series.color;

            this.element.appendChild(dot);

            dot.className = 'dot active';

            this.show();

        }, this );
    }
});

var hover = new Hover( { graph: graph } ); 

var legend = new Rickshaw.Graph.Legend({
    graph: graph,
    element: document.getElementById('legend')
});

var shelving = new Rickshaw.Graph.Behavior.Series.Toggle({
    graph: graph,
    legend: legend
});

var highlighter = new Rickshaw.Graph.Behavior.Series.Highlight({
    graph: graph,
    legend: legend
});

var x_axis = new Rickshaw.Graph.Axis.Time({ graph: graph });

var y_axis = new Rickshaw.Graph.Axis.Y({
    graph: graph,
    orientation: 'left',
    tickFormat: Rickshaw.Fixtures.Number.formatKMBT,
    element: document.getElementById('y_axis'),
});

document.getElementById('offset_form').addEventListener('change', function(e) {
    graph.setRenderer(e.target.value);
    graph.render();
}, false);

var range_slider = new Rickshaw.Graph.RangeSlider( {
    graph: graph,
    element: document.getElementById('range_slider'),
} );

graph.render();

</script>

</body>
