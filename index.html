<!doctype>
<head>
    <meta charset="utf-8" />
    <script type="text/javascript" src="js/dygraph-combined.js"></script>
    <script type="text/javascript" src="js/synchronizer.js"></script>
    <script type="text/javascript" src="wiibee.js"></script>
</head>
<body>

<style>
.graphdiv {
    width: 600px;
    height: 200px;
}
</style>

<script type="text/javascript">

function getColors(num, sat, val) {
    var colors = [];
    var half = Math.ceil(num / 2);
    for (var i = 0; i < num; i++) {
        // alternate colors for high contrast.
        var idx = i % 2 ? (half + (i + 1)/ 2) : Math.ceil((i + 1) / 2);
        var hue = (1.0 * idx / (1 + num));
        colors.push(Dygraph.hsvToRGB(hue, sat, val));
    }
    return colors;
}
// must calibrate each balance and setup the offsets accordingly
var offset = [     0,       0,   0,    1,   -1,    2,   -2,    3,   -3,    4];
var labels = ["Date", "TÂ°CPU", "T", "M1", "M2", "M3", "M4", "M5", "M6", "M7"];
var multi  = [    [],      [],  [],   [],    [],  [],   [],   [],   [],   []];
var ndata  = 0;
wiibee.forEach(function(elt1, index1, arr1) {
    elt1.forEach(function(elt2, index2, arr2) {
        multi[index2].push([new Date(1000*elt1[0]), elt2+offset[index2]]);
        ndata = Math.max(index2,ndata);
    });
});
var colors = getColors(ndata, 1.0, 0.5);

function gr(index) {
    var elt = document.createElement("div");
    elt.className = "graphdiv";
    document.body.appendChild(elt);
    return new Dygraph(elt, multi[index], {
        labels: ["Date", labels[index]],
        colors: [colors[index-1]],
        axes: {
            x: {
                valueFormatter: function(value) {
                    return new Date(value).toISOString();
                },
            },
            y: {
                valueFormatter: function(value) {
                    return (value < 10 && value >= 0 ? '0' : '') + value.toFixed(2);
                },
            },
        },
    });
}
var gs = [];
for (var i = 1; i < ndata+1; i++) {
    gs.push(gr(i));
}

var sync = Dygraph.synchronize(gs, {
  selection: true,
  zoom: true,
});

</script>

</body>
